# Marks Hammond's version for Pythonwin.
# Builds the DLL into the same directory as the Pythonwin binaries.
# The scintilla directory should be under the Pythonwin directory.
# Thus, your tree should look like:
# Pythonwin\*.cpp - existing Pythonwin sources
# Pythonwin\build - Where pythonwin binaries go.
# Pythonwin\scintilla - Directory of this file and scintilla sources.
#
# This makefile will place binaries and obj files in the Pythonwin build tree.

# Make file for Scintilla and Tide, Windows Visual C++ version
# Copyright 1998-1999 by Neil Hodgson <neilh@hare.net.au>
# The License.txt file describes the conditions under which this software may be distributed.
# This makefile is for using Visual C++ and nmake. 

TEMP_DIR=../Build/Temp/Scintilla
BUILD_DIR=../Build

CC      = cl
O		= obj
PROG	= Tide.EXE
PROGSTATIC = Tidy.EXE
COMPONENT = $(BUILD_DIR)/Scintilla.DLL
LDBASE = KERNEL32.lib USER32.lib GDI32.lib COMDLG32.lib WINMM.lib COMCTL32.lib ADVAPI32.lib OLE32.lib imm32.lib

!ifdef DEBUG
CPPFLAGS = /TP /MD /Zi /Fo$*.$(O)
LDFLAGS = $(LDBASE) /DEBUG
!else
CPPFLAGS = /TP /MD /Ox /Fo$*.$(O)
LDFLAGS = $(LDBASE)
!endif

OBJS	= Tide.$(O) KeyWords.$(O) PropSet.$(O)
OBJSSTATIC = Tidy.$(O) KeyWords.$(O) PropSet.$(O) ScintillaS.$(O) Document.$(O) CallTip.$(O)

OBJSCOMP	= $(TEMP_DIR)\ScintillaWin.$(O) $(TEMP_DIR)\ScintillaBase.$(O) \
	$(TEMP_DIR)\Editor.$(O) $(TEMP_DIR)\Document.$(O) \
	$(TEMP_DIR)\CellBuffer.$(O) $(TEMP_DIR)\CallTip.$(O) \
	$(TEMP_DIR)\PlatWin.$(O) $(TEMP_DIR)\KeyMap.$(O) $(TEMP_DIR)\Indicator.$(O) \
	$(TEMP_DIR)\LineMarker.$(O) $(TEMP_DIR)\Style.$(O) $(TEMP_DIR)\ViewStyle.$(O) $(TEMP_DIR)\AutoComplete.$(O)


ALL:	before $(COMPONENT)

before:
	@if not exist $(TEMP_DIR) mkdir "$(TEMP_DIR)"
	@if not exist $(BUILD_DIR) mkdir "$(BUILD_DIR)"

$(TEMP_DIR)\AutoComplete.$(O):	AutoComplete.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\CellBuffer.$(O):	CellBuffer.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\CallTip.$(O):	CallTip.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\Document.$(O):	Document.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\Editor.$(O):	Editor.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\Indicator.$(O):	Indicator.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\KeyMap.$(O):	KeyMap.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\KeyWords.$(O):	KeyWords.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\LineMarker.$(O):	LineMarker.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\PlatWin.$(O):	PlatWin.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\PropSet.$(O):	PropSet.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\ScintillaBase.$(O):	ScintillaBase.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\ScintillaWin.$(O):	ScintillaWin.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\SciTE.$(O): SciTE.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\Tidy.$(O): SciTE.cxx
	cl $(CPPFLAGS) /D STATIC_BUILD /c SciTE.cxx /FoTidy.$(O)
$(TEMP_DIR)\ScintillaWinS.$(O):	ScintillaWin.cxx
	cl $(CPPFLAGS) /D STATIC_BUILD /c ScintillaWin.cxx /FoScintillaWinS.$(O)
$(TEMP_DIR)\Style.$(O):	Style.cxx
	cl $(CPPFLAGS) /c $(*B).cxx
$(TEMP_DIR)\ViewStyle.$(O):	ViewStyle.cxx
	cl $(CPPFLAGS) /c $(*B).cxx

$(PROG): $(OBJS) SciTERes.res
	$(CC) -o $(PROG) $(OBJS) SciTERes.res $(LDFLAGS)

#$(COMPONENT): $(OBJSCOMP) ScintRes.res
#	$(CC) /LD -o $(COMPONENT) $(OBJSCOMP) ScintRes.res $(LDFLAGS)

$(COMPONENT): $(OBJSCOMP) $(TEMP_DIR)/ScintRes.res
	link $** $(LDFLAGS) /DLL /OUT:$(COMPONENT) 

$(TEMP_DIR)/ScintRes.res:	ScintRes.rc
	rc /fo$*.res ScintRes.rc
